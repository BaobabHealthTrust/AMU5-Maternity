<script>
  var tt_cancel_destination = "/patients/show/<%= @patient.id%>?auto_load_forms=false"

  function checkEDD(){
    var edd = "<%= (@lmp.to_date + 7.days + 9.months).strftime("%Y-%m-%d") rescue "" %>";
  
  }

</script>
<style>
  #space { display:inline; font-size:1.2em; }
  #Unknown {display: none;}
  #num {display: none;}
</style>
<form id='outcome' action="/encounters/create" method='post'>

  <%@presentation = [""] + Concept.find_by_name("PRESENTATION").concept_answers.collect{|c| c.name} %>
  <%@baby_outcome = [""] + Concept.find_by_name("BABY OUTCOME").concept_answers.collect{|c| c.name} %>
  <% @main_outcomes = [""] + Concept.find_by_name("MATERNITY OUTCOME").concept_members_names rescue [] %>
  <% @delivery_period = ["", "DELIVERED IN THE WARD",
    "DELIVERED BEFORE ARRIVAL",
    "DELIVERED IN THEATRE",
    "DELIVERED IN ANTENATAL WARD"] %>
 
  <%@delivery_mode = [""] + Concept.find_by_name("DELIVERY MODE").concept_answers.collect{|c| c.name} %>
  <%@procedure_done = [""] + Concept.find_by_name("PROCEDURE DONE").concept_answers.collect{|c| c.name}.sort %>
  <%@postpartum_type = ["", "TOTAL POSTPARTUM HYSTERECTOMY", "SUB-TOTAL POSTPARTUM HYSTERECTOMY"]%>
  <%@discharged_to_where = ["", "HOME", "ANOTHER HEALTH FACILITY"]%>
  <%@health_facility = ["", "KCH"]%>

  <%= hidden_field_tag "encounter[encounter_type_name]", "BABY DELIVERY" %>
  <%= hidden_field_tag "encounter[patient_id]", @patient.id %>
  <%= hidden_field_tag "encounter[encounter_datetime]", DateTime.now() %>
  <%= hidden_field_tag "encounter[provider_id]", session[:user_id] %>

  <%# options = {
    :id => "number_of_babies",
    :field_type => 'number',
    :helptext =>"Number of babies",
    :tt_pageStyleClass => "Numeric NumbersOnly"
  }%>
  <%#= hidden_field_tag("observations[][concept_name]",  "NUMBER OF BABIES")%>
  <%#= text_field_tag("observations[][value_coded_or_text]",   nil, options)%>
  <%#= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%#= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <!-- From Here - Set 1 -->
  <% options = {
    :id => "presentation",
    :field_type => 'text',
    :helptext =>"Baby: Presentation"
  }%>
  <%= hidden_field_tag("observations[][concept_name]",  "PRESENTATION") %>
  <%= select_tag("observations[][value_coded_or_text]", options_for_select(@presentation), options)%>
  <%= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <% options = {
    :id => "baby_outcome",
    :field_type => 'text',
    :helptext =>"Baby: Outcome"
  }%>
  <%= hidden_field_tag("observations[][concept_name]",  "BABY OUTCOME") %>
  <%= select_tag("observations[][value_coded_or_text]", options_for_select(@baby_outcome), options)%>
  <%= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <% options = {
    :id => "time_of_delivery",
    :field_type => 'time',
    :helptext =>"Baby: Time of Delivery"
  }%>
  <%= hidden_field_tag("observations[][concept_name]",  "TIME OF DELIVERY")%>
  <%= text_field_tag("observations[][value_time]",   nil, options)%>
  <%= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <% options = {
    :id => "date_of_delivery",
    :field_type => 'date',
    :helptext =>"Baby: Date of Delivery",
    :tt_onUnload => "checkEDD()"
  }%>
  <%= hidden_field_tag("observations[][concept_name]",  "DATE OF DELIVERY")%>
  <%= text_field_tag("observations[][value_datetime]",   nil, options)%>
  <%= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <% options = {
    :id => "delivery_mode",
    :field_type => 'text',
    :helptext =>"Baby: Delivery Mode",
    :tt_pageStyleClass => "qwertyKeyboardOnly"
  }%>
  <%= hidden_field_tag("observations[][concept_name]",  "DELIVERY MODE") %>
  <%= select_tag("observations[][value_coded_or_text]", options_for_select(@delivery_mode), options)%>
  <%= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <!-- Finish here Set 1 -->

  <!-- From Here - Set 2 -->
  <%# options = {
    :id => "presentation2",
    :field_type => 'text',
    :helptext =>"2<sup>nd</sup> Baby: Presentation",
    :condition => "(parseInt($('number_of_babies').value) > 1)"
  }%>
  <%#= hidden_field_tag("observations[][concept_name]",  "PRESENTATION") %>
  <%#= select_tag("observations[][value_coded_or_text]", options_for_select(@presentation), options)%>
  <%#= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%#= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <%# options = {
    :id => "baby_outcome2",
    :field_type => 'text',
    :helptext =>"1<sup>st</sup> Baby: Outcome",
    :condition => "(parseInt($('number_of_babies').value) > 1)"
  }%>
  <%#= hidden_field_tag("observations[][concept_name]",  "BABY OUTCOME") %>
  <%#= select_tag("observations[][value_coded_or_text]", options_for_select(@baby_outcome), options)%>
  <%#= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%#= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <%# options = {
    :id => "time_of_delivery2",
    :field_type => 'time',
    :helptext =>"2<sup>nd</sup> Baby: Time of Delivery",
    :condition => "(parseInt($('number_of_babies').value) > 1)"
  }%>
  <%#= hidden_field_tag("observations[][concept_name]",  "TIME OF DELIVERY")%>
  <%#= text_field_tag("observations[][value_time]",   nil, options)%>
  <%#= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%#= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <%# options = {
    :id => "date_of_delivery2",
    :field_type => 'date',
    :helptext =>"2<sup>nd</sup> Baby: Date of Delivery",
    :condition => "(parseInt($('number_of_babies').value) > 1)"
  }%>
  <%#= hidden_field_tag("observations[][concept_name]",  "DATE OF DELIVERY")%>
  <%#= text_field_tag("observations[][value_datetime]",   nil, options)%>
  <%#= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%#= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <%# options = {
    :id => "delivery_mode2",
    :field_type => 'text',
    :helptext =>"2<sup>nd</sup> Baby: Delivery Mode",
    :condition => "(parseInt($('number_of_babies').value) > 1)"
  }%>
  <%#= hidden_field_tag("observations[][concept_name]",  "DELIVERY MODE") %>
  <%#= select_tag("observations[][value_coded_or_text]", options_for_select(@delivery_mode), options)%>
  <%#= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%#= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <!-- Finish here Set 2 -->

  <!-- From Here - Set 3 -->
  <%# options = {
    :id => "presentation3",
    :field_type => 'text',
    :helptext =>"3<sup>rd</sup> Baby: Presentation",
    :condition => "(parseInt($('number_of_babies').value) > 2)"
  }%>
  <%#= hidden_field_tag("observations[][concept_name]",  "PRESENTATION") %>
  <%#= select_tag("observations[][value_coded_or_text]", options_for_select(@presentation), options)%>
  <%#= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%#= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <%# options = {
    :id => "baby_outcome3",
    :field_type => 'text',
    :helptext =>"1<sup>st</sup> Baby: Outcome",
    :condition => "(parseInt($('number_of_babies').value) > 2)"
  }%>
  <%#= hidden_field_tag("observations[][concept_name]",  "BABY OUTCOME") %>
  <%#= select_tag("observations[][value_coded_or_text]", options_for_select(@baby_outcome), options)%>
  <%#= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%#= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <%# options = {
    :id => "time_of_delivery3",
    :field_type => 'time',
    :helptext =>"3<sup>rd</sup> Baby: Time of Delivery",
    :condition => "(parseInt($('number_of_babies').value) > 2)"
  }%>
  <%#= hidden_field_tag("observations[][concept_name]",  "TIME OF DELIVERY")%>
  <%#= text_field_tag("observations[][value_time]",   nil, options)%>
  <%#= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%#= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <%# options = {
    :id => "date_of_delivery3",
    :field_type => 'date',
    :helptext =>"3<sup>rd</sup> Baby: Date of Delivery",
    :condition => "(parseInt($('number_of_babies').value) > 2)"
  }%>
  <%#= hidden_field_tag("observations[][concept_name]",  "DATE OF DELIVERY")%>
  <%#= text_field_tag("observations[][value_datetime]",   nil, options)%>
  <%#= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%#= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <%# options = {
    :id => "delivery_mode3",
    :field_type => 'text',
    :helptext =>"3<sup>rd</sup> Baby: Delivery Mode",
    :condition => "(parseInt($('number_of_babies').value) > 2)"
  }%>
  <%#= hidden_field_tag("observations[][concept_name]",  "DELIVERY MODE") %>
  <%#= select_tag("observations[][value_coded_or_text]", options_for_select(@delivery_mode), options)%>
  <%#= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%#= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <!-- Finish here Set 3 -->

  <% options = {
    :id => "procedure_done",
    :field_type => 'text',
    :helptext =>"Procedure Done",
    :tt_pageStyleClass => "qwertyKeyboardOnly"
  }%>
  <%= hidden_field_tag("observations[][concept_name]",  "PROCEDURE DONE") %>
  <%= select_tag("observations[][value_coded_or_text]", options_for_select(@procedure_done), options)%>
  <%= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <% options = {
    :id => "postpartum_type",
    :field_type => 'text',
    :helptext =>"Select Postpartum Hesterectomy Type",
    :condition => "($('procedure_done').value == 'POSTPARTUM HYSTERECTOMY')",
    :tt_pageStyleClass => "qwertyKeyboardOnly"
  }%>
  <%= hidden_field_tag("observations[][concept_name]",  "POSTPARTUM HYSTERECTOMY") %>
  <%= select_tag("observations[][value_coded_or_text]", options_for_select(@postpartum_type), options)%>
  <%= hidden_field_tag("observations[][patient_id]",    @patient.id) %>
  <%= hidden_field_tag("observations[][obs_datetime]",  DateTime.now()) %>

  <%= hidden_field_tag("programs[][patient_program_id]", @maternity_program_id) %>
  <%= hidden_field_tag("programs[][program_id]", Program.find_by_name('MATERNITY PROGRAM').id) %>
  <%= hidden_field_tag("programs[][location_id]", Location.current_health_center.id) %>
  <%= hidden_field_tag("programs[][date_enrolled]", session[:datetime] ) %>
  <%= hidden_field_tag("programs[][states][][state]", "Delivered") %>

  <%= hidden_field_tag "next_url", "/encounters/new/refer_out/?patient_id=#{@patient.id}", {:disabled => true} %>

  <%= submit_tag "Finish" %>

</form>
